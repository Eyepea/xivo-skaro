gbour gbour@proformatique.com
Index: asterisk-1.8.4.1/channels/chan_sip.c
===================================================================
--- asterisk-1.8.4.1.orig/channels/chan_sip.c	2011-05-25 09:44:04.116683047 -0400
+++ asterisk-1.8.4.1/channels/chan_sip.c	2011-05-25 09:44:12.906681380 -0400
@@ -25377,6 +25377,16 @@
 	/* Divvy up the items separated by slashes */
 	AST_NONSTANDARD_APP_ARGS(args, tmp, '/');
 
+  if(args.peerorhost == NULL) {
+    dialog_unlink_all(p, TRUE, TRUE);
+    dialog_unref(p, "unref dialog p from mem fail");
+    /* sip_destroy(p); */
+    ast_log(LOG_ERROR, "SIP resource name is not set or empty");
+
+    *cause = AST_CAUSE_CHANNEL_UNACCEPTABLE;
+    return NULL;
+  }
+
 	/* Find at sign - @ */
 	host = strchr(args.peerorhost, '@');
 	if (host) {

gbour gbour@proformatique.com
Index: asterisk-1.8.1/channels/chan_sip.c
===================================================================
--- asterisk-1.8.1.orig/channels/chan_sip.c	2010-12-10 12:11:52.273396248 +0100
+++ asterisk-1.8.1/channels/chan_sip.c	2010-12-10 12:15:34.965397526 +0100
@@ -25028,6 +25028,16 @@
 	/* Divvy up the items separated by slashes */
 	AST_NONSTANDARD_APP_ARGS(args, tmp, '/');
 
+  if(args.peerorhost == NULL) {
+    dialog_unlink_all(p, TRUE, TRUE);
+    dialog_unref(p, "unref dialog p from mem fail");
+    /* sip_destroy(p); */
+    ast_log(LOG_ERROR, "SIP resource name is not set or empty");
+
+    *cause = AST_CAUSE_CHANNEL_UNACCEPTABLE;
+    return NULL;
+  }
+
 	/* Find at sign - @ */
 	host = strchr(args.peerorhost, '@');
 	if (host) {
